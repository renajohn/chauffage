services:
  backend:
    build:
      context: ./backend
    restart: unless-stopped
    environment:
      - PORT=3002
      - CORS_ORIGIN=*
      - PAC_HOST=${PAC_HOST:-192.168.86.28}
      - PAC_PORT=${PAC_PORT:-8889}
      - PAC_PASSWORD=${PAC_PASSWORD:-999999}
      - NUSSBAUM_REZ_HOST=${NUSSBAUM_REZ_HOST:-therm-control.local}
      - NUSSBAUM_ETAGE_HOST=${NUSSBAUM_ETAGE_HOST:-therm-control-2.local}
      - POLL_INTERVAL=10000
      - NUSSBAUM_POLL_INTERVAL=30000
    volumes:
      - backend-data:/app/data
    networks:
      - web

  frontend:
    build:
      context: ./frontend
    restart: unless-stopped
    depends_on:
      - backend
    networks:
      - web
    labels:
      - "com.centurylinklabs.watchtower.enable=true"
      - "traefik.enable=true"
      - "traefik.http.routers.chauffage.rule=Host(`chauffage.lab.crog.org`)"
      - "traefik.http.routers.chauffage.entrypoints=websecure"
      - "traefik.http.routers.chauffage.tls=true"
      - "traefik.http.services.chauffage.loadbalancer.server.port=80"
      - homepage.group=Apps
      - homepage.name=Thermostat
      - homepage.description=PAC g√©othermique & plancher chauffant
      - homepage.href=https://chauffage.lab.crog.org
      - homepage.icon=https://chauffage.lab.crog.org/favicon.svg
volumes:
  backend-data:

networks:
  web:
    external: true
